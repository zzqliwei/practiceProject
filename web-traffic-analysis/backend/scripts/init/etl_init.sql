--预解析阶段初始化脚本
CREATE DATABASE IF NOT EXISTS rawdata;

--主ETL阶段初始化脚本
CREATE DATABASE IF NOT EXISTS web;
CREATE DATABASE IF NOT EXISTS web_tmp;

DROP TABLE IF EXISTS `web.session`;
CREATE EXTERNAL TABLE IF NOT EXISTS `web.session`(
  `tracker_version` string COMMENT '',
    `profile_id` int COMMENT '',
    `user_id` string COMMENT '',
    `days_since_last_visit` int COMMENT '',
    `user_visit_number` int COMMENT '',
    `is_new_visitor` boolean COMMENT '',
    `server_session_id` bigint COMMENT '',
    `session_duration` int COMMENT '',
    `session_server_time` string COMMENT '',
    `hour_of_day` int COMMENT '',
    `month_of_year` int COMMENT '',
    `day_of_week` string COMMENT '',
    `week_of_year` int COMMENT '',
    `referrer_url` string COMMENT '',
    `referrer_hostname` string COMMENT '',
    `source_type` string COMMENT '',
    `channel_name` string COMMENT '',
    `search_engine` string COMMENT '',
    `keyword_id` string COMMENT '',
    `keywords` string COMMENT '',
    `is_paid_traffic` boolean COMMENT '',
    `ad_campaign` string COMMENT '',
    `ad_channel` string COMMENT '',
    `ad_source` string COMMENT '',
    `ad_medium` string COMMENT '',
    `ad_keywords` string COMMENT '',
    `ad_content` string COMMENT '',
    `user_agent` string COMMENT '',
    `browser_brief` string COMMENT '',
    `browser_detail` string COMMENT '',
    `browser_language` string COMMENT '',
    `is_mobile` boolean COMMENT '',
    `device_brand` string COMMENT '',
    `device_type` string COMMENT '',
    `device_name` string COMMENT '',
    `screen_resolution` string COMMENT '',
    `color_depth` string COMMENT '',
    `flash_version` string COMMENT '',
    `silverlight_version` string COMMENT '',
    `java_enabled` boolean COMMENT '',
    `cookie_enabled` boolean COMMENT '',
    `alexa_toolbar_installed` boolean COMMENT '',
    `os_language` string COMMENT '',
    `country` string COMMENT '',
    `province` string COMMENT '',
    `city` string COMMENT '',
    `longitude` float COMMENT '',
    `latitude` float COMMENT '',
    `client_ip` string COMMENT '',
    `landing_page_url` string COMMENT '',
    `landing_page_original_url` string COMMENT '',
    `landing_page_hostname` string COMMENT '',
    `landing_page_title` string COMMENT '',
    `second_page_url` string COMMENT '',
    `second_page_original_url` string COMMENT '',
    `second_page_hostname` string COMMENT '',
    `second_page_title` string COMMENT '',
    `exit_page_url` string COMMENT '',
    `exit_page_original_url` string COMMENT '',
    `exit_page_hostname` string COMMENT '',
    `exit_page_title` string COMMENT '',
    `is_bounced` boolean COMMENT '',
    `pv_count` int COMMENT '',
    `pv_distinct_count` int COMMENT '',
    `conversion_count` int COMMENT '',
    `event_count` int COMMENT '',
    `event_distinct_count` int COMMENT '',
    `target_count` int COMMENT '',
    `target_distinct_count` int COMMENT '',
    `mouse_click_count` int COMMENT '')
PARTITIONED BY (year int, month int, day int)
STORED AS PARQUET;

DROP TABLE IF EXISTS `web.pageview`;
CREATE EXTERNAL TABLE IF NOT EXISTS `web.pageview`(
  `tracker_version` string COMMENT '',
    `profile_id` int COMMENT '',
    `user_id` string COMMENT '',
    `page_view_id` string COMMENT '',
    `page_url` string COMMENT '',
    `page_original_url` string COMMENT '',
    `page_hostname` string COMMENT '',
    `page_title` string COMMENT '',
    `page_view_referrer_url` string COMMENT '',
    `access_order` int COMMENT '',
    `is_exit_page` boolean COMMENT '',
    `is_refresh` boolean COMMENT '',
    `page_view_server_time` string COMMENT '',
    `page_view_depth` int COMMENT '',
    `loading_duration` int COMMENT '',
    `page_duration` int COMMENT '',
    `days_since_last_visit` int COMMENT '',
    `user_visit_number` int COMMENT '',
    `is_new_visitor` boolean COMMENT '',
    `server_session_id` bigint COMMENT '',
    `session_duration` int COMMENT '',
    `session_server_time` string COMMENT '',
    `hour_of_day` int COMMENT '',
    `month_of_year` int COMMENT '',
    `day_of_week` string COMMENT '',
    `week_of_year` int COMMENT '',
    `referrer_url` string COMMENT '',
    `referrer_hostname` string COMMENT '',
    `source_type` string COMMENT '',
    `channel_name` string COMMENT '',
    `search_engine` string COMMENT '',
    `keyword_id` string COMMENT '',
    `keywords` string COMMENT '',
    `is_paid_traffic` boolean COMMENT '',
    `ad_campaign` string COMMENT '',
    `ad_channel` string COMMENT '',
    `ad_source` string COMMENT '',
    `ad_medium` string COMMENT '',
    `ad_keywords` string COMMENT '',
    `ad_content` string COMMENT '',
    `user_agent` string COMMENT '',
    `browser_brief` string COMMENT '',
    `browser_detail` string COMMENT '',
    `is_mobile` boolean COMMENT '',
    `device_brand` string COMMENT '',
    `device_type` string COMMENT '',
    `device_name` string COMMENT '',
    `screen_resolution` string COMMENT '',
    `color_depth` string COMMENT '',
    `flash_version` string COMMENT '',
    `silverlight_version` string COMMENT '',
    `java_enabled` boolean COMMENT '',
    `cookie_enabled` boolean COMMENT '',
    `alexa_toolbar_installed` boolean COMMENT '',
    `os_language` string COMMENT '',
    `browser_language` string COMMENT '',
    `country` string COMMENT '',
    `province` string COMMENT '',
    `city` string COMMENT '',
    `longitude` float COMMENT '',
    `latitude` float COMMENT '',
    `client_ip` string COMMENT '',
    `landing_page_url` string COMMENT '',
    `landing_page_original_url` string COMMENT '',
    `landing_page_hostname` string COMMENT '',
    `landing_page_title` string COMMENT '',
    `second_page_url` string COMMENT '',
    `second_page_original_url` string COMMENT '',
    `second_page_hostname` string COMMENT '',
    `second_page_title` string COMMENT '',
    `exit_page_url` string COMMENT '',
    `exit_page_original_url` string COMMENT '',
    `exit_page_hostname` string COMMENT '',
    `exit_page_title` string COMMENT '',
    `is_bounced` boolean COMMENT '',
    `pv_count` int COMMENT '',
    `pv_distinct_count` int COMMENT '',
    `conversion_count` int COMMENT '',
    `event_count` int COMMENT '',
    `event_distinct_count` int COMMENT '',
    `target_count` int COMMENT '',
    `target_distinct_count` int COMMENT '',
    `mouse_click_count` int COMMENT '')
PARTITIONED BY (year int, month int, day int)
STORED AS PARQUET;

DROP TABLE IF EXISTS `web.mouseclick`;
CREATE EXTERNAL TABLE IF NOT EXISTS `web.mouseclick`(
  `tracker_version` string COMMENT '',
    `profile_id` int COMMENT '',
    `user_id` string COMMENT '',
    `page_view_id` string COMMENT '',
    `click_page_url` string COMMENT '',
    `click_page_original_url` string COMMENT '',
    `click_page_hostname` string COMMENT '',
    `click_page_title` string COMMENT '',
    `mouse_click_server_time` string COMMENT '',
    `click_x` int COMMENT '',
    `click_y` int COMMENT '',
    `page_version` string COMMENT '',
    `region_id` int COMMENT '',
    `snapshot_id` int COMMENT '',
    `click_screen_resolution` string COMMENT '',
    `link_hostname` string COMMENT '',
    `link_url` string COMMENT '',
    `link_text` string COMMENT '',
    `link_x` int COMMENT '',
    `link_y` int COMMENT '',
    `link_width` int COMMENT '',
    `link_height` int COMMENT '',
    `is_link_clicked` boolean COMMENT '',
    `days_since_last_visit` int COMMENT '',
    `user_visit_number` int COMMENT '',
    `is_new_visitor` boolean COMMENT '',
    `server_session_id` bigint COMMENT '',
    `session_duration` int COMMENT '',
    `session_server_time` string COMMENT '',
    `hour_of_day` int COMMENT '',
    `month_of_year` int COMMENT '',
    `day_of_week` string COMMENT '',
    `week_of_year` int COMMENT '',
    `referrer_url` string COMMENT '',
    `referrer_hostname` string COMMENT '',
    `source_type` string COMMENT '',
    `channel_name` string COMMENT '',
    `search_engine` string COMMENT '',
    `keyword_id` string COMMENT '',
    `keywords` string COMMENT '',
    `is_paid_traffic` boolean COMMENT '',
    `ad_campaign` string COMMENT '',
    `ad_channel` string COMMENT '',
    `ad_source` string COMMENT '',
    `ad_medium` string COMMENT '',
    `ad_keywords` string COMMENT '',
    `ad_content` string COMMENT '',
    `user_agent` string COMMENT '',
    `browser_brief` string COMMENT '',
    `browser_detail` string COMMENT '',
    `is_mobile` boolean COMMENT '',
    `device_brand` string COMMENT '',
    `device_type` string COMMENT '',
    `device_name` string COMMENT '',
    `screen_resolution` string COMMENT '',
    `color_depth` string COMMENT '',
    `flash_version` string COMMENT '',
    `silverlight_version` string COMMENT '',
    `java_enabled` boolean COMMENT '',
    `cookie_enabled` boolean COMMENT '',
    `alexa_toolbar_installed` boolean COMMENT '',
    `os_language` string COMMENT '',
    `browser_language` string COMMENT '',
    `country` string COMMENT '',
    `province` string COMMENT '',
    `city` string COMMENT '',
    `longitude` float COMMENT '',
    `latitude` float COMMENT '',
    `client_ip` string COMMENT '',
    `landing_page_url` string COMMENT '',
    `landing_page_original_url` string COMMENT '',
    `landing_page_hostname` string COMMENT '',
    `landing_page_title` string COMMENT '',
    `second_page_url` string COMMENT '',
    `second_page_original_url` string COMMENT '',
    `second_page_hostname` string COMMENT '',
    `second_page_title` string COMMENT '',
    `exit_page_url` string COMMENT '',
    `exit_page_original_url` string COMMENT '',
    `exit_page_hostname` string COMMENT '',
    `exit_page_title` string COMMENT '',
    `is_bounced` boolean COMMENT '',
    `pv_count` int COMMENT '',
    `pv_distinct_count` int COMMENT '',
    `conversion_count` int COMMENT '',
    `event_count` int COMMENT '',
    `event_distinct_count` int COMMENT '',
    `target_count` int COMMENT '',
    `target_distinct_count` int COMMENT '',
    `mouse_click_count` int COMMENT '')
PARTITIONED BY (year int, month int, day int)
STORED AS PARQUET;

DROP TABLE IF EXISTS `web.heartbeat`;
CREATE EXTERNAL TABLE IF NOT EXISTS `web.heartbeat`(
  `tracker_version` string COMMENT '',
    `profile_id` int COMMENT '',
    `user_id` string COMMENT '',
    `server_session_id` bigint COMMENT '',
    `server_time` string COMMENT '',
    `loading_duration` int COMMENT '',
    `page_view_id` string COMMENT '')
PARTITIONED BY (year int, month int, day int)
STORED AS PARQUET;

DROP TABLE IF EXISTS `web.conversion`;
CREATE EXTERNAL TABLE IF NOT EXISTS `web.conversion`(
  `tracker_version` string COMMENT '',
    `profile_id` int COMMENT '',
    `user_id` string COMMENT '',
    `page_view_id` string COMMENT '',
    `type` string COMMENT '',
    `category` string COMMENT '',
    `label` string COMMENT '',
    `name` string COMMENT '',
    `conversion_id` string COMMENT '',
    `conversion_page_url` string COMMENT '',
    `conversion_page_title` string COMMENT '',
    `conversion_page_hostname` string COMMENT '',
    `conversion_value` float COMMENT '',
    `conversion_server_time` string COMMENT '',
    `days_since_last_visit` int COMMENT '',
    `user_visit_number` int COMMENT '',
    `is_new_visitor` boolean COMMENT '',
    `server_session_id` bigint COMMENT '',
    `session_duration` int COMMENT '',
    `session_server_time` string COMMENT '',
    `hour_of_day` int COMMENT '',
    `month_of_year` int COMMENT '',
    `day_of_week` string COMMENT '',
    `week_of_year` int COMMENT '',
    `referrer_url` string COMMENT '',
    `referrer_hostname` string COMMENT '',
    `source_type` string COMMENT '',
    `channel_name` string COMMENT '',
    `search_engine` string COMMENT '',
    `keyword_id` string COMMENT '',
    `keywords` string COMMENT '',
    `is_paid_traffic` boolean COMMENT '',
    `ad_campaign` string COMMENT '',
    `ad_channel` string COMMENT '',
    `ad_source` string COMMENT '',
    `ad_medium` string COMMENT '',
    `ad_keywords` string COMMENT '',
    `ad_content` string COMMENT '',
    `user_agent` string COMMENT '',
    `browser_brief` string COMMENT '',
    `browser_detail` string COMMENT '',
    `is_mobile` boolean COMMENT '',
    `device_brand` string COMMENT '',
    `device_type` string COMMENT '',
    `device_name` string COMMENT '',
    `screen_resolution` string COMMENT '',
    `color_depth` string COMMENT '',
    `flash_version` string COMMENT '',
    `silverlight_version` string COMMENT '',
    `java_enabled` boolean COMMENT '',
    `cookie_enabled` boolean COMMENT '',
    `alexa_toolbar_installed` boolean COMMENT '',
    `os_language` string COMMENT '',
    `browser_language` string COMMENT '',
    `country` string COMMENT '',
    `province` string COMMENT '',
    `city` string COMMENT '',
    `longitude` float COMMENT '',
    `latitude` float COMMENT '',
    `client_ip` string COMMENT '',
    `landing_page_url` string COMMENT '',
    `landing_page_original_url` string COMMENT '',
    `landing_page_hostname` string COMMENT '',
    `landing_page_title` string COMMENT '',
    `second_page_url` string COMMENT '',
    `second_page_original_url` string COMMENT '',
    `second_page_hostname` string COMMENT '',
    `second_page_title` string COMMENT '',
    `exit_page_url` string COMMENT '',
    `exit_page_original_url` string COMMENT '',
    `exit_page_hostname` string COMMENT '',
    `exit_page_title` string COMMENT '',
    `is_bounced` boolean COMMENT '',
    `pv_count` int COMMENT '',
    `pv_distinct_count` int COMMENT '',
    `conversion_count` int COMMENT '',
    `event_count` int COMMENT '',
    `event_distinct_count` int COMMENT '',
    `target_count` int COMMENT '',
    `target_distinct_count` int COMMENT '',
    `mouse_click_count` int COMMENT '')
PARTITIONED BY (year int, month int, day int)
STORED AS PARQUET;